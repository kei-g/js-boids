var T=o=>{throw TypeError(o)};var M=(o,t,e)=>t.has(o)||T("Cannot "+e);var l=(o,t,e)=>(M(o,t,"read from private field"),e?e.call(o):t.get(o)),m=(o,t,e)=>t.has(o)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),C=(o,t,e,i)=>(M(o,t,"write to private field"),i?i.call(o,e):t.set(o,e),e),w=(o,t,e)=>(M(o,t,"access private method"),e);var A=o=>{let t=o;return typeof t=="object"&&typeof t.suffocation=="number"},O=o=>{let t=o;return typeof o=="object"&&A(t.degrees)&&g(t.position)&&g(t.velocity)};var I=o=>{let t=o;return typeof o=="object"&&typeof t.height=="number"&&typeof t.width=="number"};var g=o=>{let t=o;return typeof o=="object"&&typeof t.x=="number"&&typeof t.y=="number"};var a=class o{constructor(t,e){t instanceof o?(this.$dirty=t.$dirty,this.$length=t.$length,this.$squareOfLength=t.$squareOfLength,this.$x=t.x,this.$y=t.y):(this.$dirty=!0,g(t)?(this.$x=t.x,this.$y=t.y):(this.$x=t,this.$y=e))}add(t){this.$dirty=!0,this.$x+=t.x,this.$y+=t.y}added(t){return new o(this.$x+t.x,this.$y+t.y)}get clone(){return new o(this)}get collisionDetector(){return t=>t.doesCollide(this)}copyTo(t){t.$dirty=this.$dirty,t.$length=this.$length,t.$squareOfLength=this.$squareOfLength,t.$x=this.$x,t.$y=this.$y}crossProduct(t){return this.$x*t.y-this.$y*t.x}divide(t){this.$dirty||(this.$length/=t,this.$squareOfLength/=t*t),this.$x/=t,this.$y/=t}dividedBy(t){let e=this.clone;return e.$dirty||(e.$length/=t,e.$squareOfLength/=t*t),e.$x/=t,e.$y/=t,e}dotProduct(t){return this.$x*t.x+this.$y*t.y}from(t){return new o(this.$x-t.x,this.$y-t.y)}get length(){return this.$dirty&&(this.$dirty=!1,this.$length=Math.hypot(this.$x,this.$y),this.$squareOfLength=this.dotProduct(this)),this.$length}get squareOfLength(){return this.$dirty&&(this.$dirty=!1,this.$length=Math.hypot(this.$x,this.$y),this.$squareOfLength=this.dotProduct(this)),this.$squareOfLength}get retrorse(){let t=this.clone;return t.$x=-t.$x,t.$y=-t.$y,t}rotate(t){let[e,i,r,s]=[Math.cos(t),Math.sin(t),this.$x,this.$y];this.$x=r*e-s*i,this.$y=r*i+s*e}rotatedBy(t){let[e,i]=[Math.cos(t),Math.sin(t)],r=this.$x*e-this.$y*i,s=this.$x*i+this.$y*e,c=this.clone;return c.$x=r,c.$y=s,c}scale(t){this.$dirty||(this.$length*=t,this.$squareOfLength*=t*t),this.$x*=t,this.$y*=t}scaledBy(t){let e=this.clone;return this.$dirty||(e.$length*=t,e.$squareOfLength*=t*t),e.$x*=t,e.$y*=t,e}sub(t){this.$dirty=!0,this.$x-=t.x,this.$y-=t.y}get x(){return this.$x}set x(t){this.$dirty=!0,this.$x=t}get y(){return this.$y}set y(t){this.$dirty=!0,this.$y=t}};var p,f=class extends a{constructor(){super(0,0);m(this,p,[]);this.count=0}add(e,i){e instanceof u?(super.add(this.resolve(e,i)),l(this,p).push(e),this.count++):super.add(e)}effectTo(e){this.count&&e.add(this.dividedBy(this.count))}get matched(){return l(this,p)}sub(e,i){e instanceof u?(super.sub(this.resolve(e,i)),l(this,p).push(e),this.count++):super.sub(e)}};p=new WeakMap;var x=class extends f{add(t,e){t instanceof u?super.sub(t,e):super.sub(t)}};var $=class extends x{match(t){let e=t.distance<12;return e&&this.add(t),e}resolve(t){return t.vector.dividedBy(t.distance*4)}};var y,v,b,E,P,n=class n{constructor(t){this.degrees={suffocation:0};if(I(t)){this.backup=new a(void 0,void 0);do{let e=20+Math.random()*(t.width-40),i=20+Math.random()*(t.height-40);this.position=new a(e,i)}while(n.circles.some(this.position.collisionDetector));this.velocity=new a(1-Math.random()*2,1-Math.random()*2)}else"backup"in t&&(this.backup=new a(t.backup)),this.degrees.suffocation=t.degrees.suffocation,this.position=new a(t.position),this.velocity=new a(t.velocity)}static generate(){l(n,y)!==void 0&&clearInterval(l(n,y)),n.all.splice(0);let t=document.getElementById("boids"),e=document.getElementById("number-of-boids"),i=document.getElementById("max-number-of-boids"),r=S(parseInt(e.value),1,parseInt(i.value),100);e.value=r.toString();for(let s=0;s<r;s++){let c=Math.floor(Math.random()*2),d=[n,B][c];n.all.push(new d(t))}C(n,y,setInterval(w(n,b,P),25)),C(n,v,r)}static get numberOfBoids(){return l(n,v)}avoidCircles(){for(let t of n.circles.filter(this.position.collisionDetector))this.position.sub(this.velocity),t.intersectingPoint(this)?.rotate(this)??(this.position.from(t.center).copyTo(this.velocity),this.normalize()),this.position.add(this.velocity)}get color(){return[this.colorForRed,this.colorForGreen,this.colorForBlue].join(",")}get colorForBlue(){return 0}get colorForGreen(){return Math.min(Math.max(0,255-this.degrees.suffocation**1.125),128)}get colorForRed(){return 255}draw(t){t.beginPath(),t.fillStyle=`rgb(${this.color})`,t.arc(this.position.x,this.position.y,1,0,Math.PI*2,!0),t.fill(),t.closePath()}get isSuffocating(){return 0<this.degrees.suffocation}move(t,e){this.nextPoint.copyTo(this.position),this.avoidCircles(),this.turnOverByEdgeOfCanvas(t,e),this.updateSuffocation()}get name(){return this.constructor.name}get nextPoint(){return this.position.added(this.nextVelocity)}get nextVelocity(){return this.velocity.added(this.backup).dividedBy(2)}normalize(){let t=.8+Math.random()*1.2,e=this.speed;t<e&&this.velocity.scale(t/e)}get others(){return n.all.filter(t=>t!==this)}get speed(){return this.velocity.length}turnOverByEdgeOfCanvas(t,e){this.position.x<0&&(this.position.x=0,this.velocity.x=Math.abs(this.velocity.x)),t<this.position.x&&(this.position.x=t,this.velocity.x=-Math.abs(this.velocity.x)),this.position.y<0&&(this.position.y=0,this.velocity.y=Math.abs(this.velocity.y)),e<this.position.y&&(this.position.y=e,this.velocity.y=-Math.abs(this.velocity.y))}update(){this.velocity.copyTo(this.backup);let t=new $,e=[t,new V(16+Math.random()*8),new D];for(let r of this.others){let s=new u(this,r);e.find(c=>c.match(s))}let i={suffocation:0};for(let r of t.matched)i.suffocation=.03125,r.relationalBoid.degrees.suffocation+=.03125;this.degrees.suffocation+=i.suffocation;for(let r of e)r.effectTo(this.velocity)}updateSuffocation(){this.degrees.suffocation+=[-.125,1][+n.circles.some(t=>t.doesCollide(this.position))],this.degrees.suffocation=Math.max(0,this.degrees.suffocation)}};y=new WeakMap,v=new WeakMap,b=new WeakSet,E=function(){let t=document.getElementById("boids"),{height:e,width:i}=t,r=t.getContext("2d");r.globalCompositeOperation="source-over",r.fillStyle="rgba(0, 0, 0, .1)",r.fillRect(0,0,i,e);for(let s of n.circles)s.draw(r);r.globalCompositeOperation="lighter";for(let s of n.all)s.draw(r);return{height:e,width:i}},P=function(){var c;let t=w(c=n,b,E).call(c),e=new Set;for(let d of n.all)d.update(),d.degrees.suffocation<128&&e.add(d);let{size:i}=e,r=q(e),{value:s}=z(e)(d=>128-d.degrees.suffocation);F({size:i,suffocating:r,value:s}),n.all.splice(0),n.all.push(...e);for(let d of n.all)d.normalize(),d.move(t.width,t.height)},m(n,b),m(n,y),m(n,v),n.all=[],n.circles=[];var h=n,q=o=>[...o].some(t=>t.isSuffocating),S=(o,t,e,i)=>isNaN(o)?i:Math.max(t,Math.min(o,e)),z=o=>t=>{let e={count:0,value:0};for(let i of o)e.value+=t(i);return e},F=o=>{let t=document.getElementById("number-of-living-boids"),e=document.getElementById("health-of-living-boids");if(o.size){let{numberOfBoids:i}=h,r=Math.floor(o.size*3/i),s=["bad","not-good","good","perfect"][r];t.setAttribute("face",[s,"warn"][+(1<r&&o.suffocating)]),t.setAttribute("status",s),t.textContent=o.size.toString(),e.textContent="\u{1F31F}"+Math.floor(o.value*9999/(i*128))}else t.removeAttribute("face"),t.removeAttribute("status"),t.textContent="",e.textContent=""};var B=class extends h{constructor(t){O(t)?super(t):super(t)}get colorForBlue(){return Math.min(Math.max(0,255-this.degrees.suffocation**1.125),255)}get colorForGreen(){return Math.min(Math.max(0,255-this.degrees.suffocation**1.125),128)}get colorForRed(){return Math.max(0,Math.min(this.degrees.suffocation*255/128,255))}};var u=class{constructor(t,e){this.relationalBoid=e;this.vector=e.position.from(t.position),this.distance=this.vector.length}};var L=class{constructor(t,e,i=100,r="rgba(32, 32, 48, .5)"){this.radius=i;this.color=r;this.center=new a(t,e)}amplitude(t,e){let i=e.position.added(e.velocity.scaledBy(t)),[r,s]=[e.nextPoint,this.center].map(c=>c.from(i));return Math.acos(r.dotProduct(s)/(r.length*s.length))}draw(t){t.beginPath(),t.fillStyle=this.color,t.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2,!0),t.fill(),t.closePath()}doesCollide(t){return this.center.from(t).length<=this.radius}intersectingPoint(t){let e=t.nextPoint.from(this.center),i=t.nextVelocity.squareOfLength,r=-t.nextVelocity.dotProduct(e),s=e.squareOfLength-this.squareOfRadius,c=r*r-i*s;if(0<=c){let d=Math.sqrt(c),R=[(r+d)/i,(r-d)/i];if(R.some(H(0,1)))return new k(this.amplitude(R[0],t))}}get squareOfRadius(){return this.radius*this.radius}},H=(o,t)=>e=>o<=e&&e<=t;var D=class extends f{match(t){let e=t.distance;for(let i=0;i<4;i++)if(e<48+i*24)return this.add(t,i),!0}resolve(t,e){return t.vector.dividedBy(t.distance*(e+1)*8)}};var k=class{constructor(t){this.rotation=Math.PI-(t*2<=Math.PI?2:1)*t}rotate(t){return t.velocity.rotate(this.rotation),!0}};var V=class extends f{constructor(e){super();this.spread=e}match(e){let i=e.distance<this.spread;return i&&this.add(e),i}resolve(e){let i=e.relationalBoid;return i.velocity.dividedBy(i.speed*32)}};var j=o=>{let t=o.target,e=t.getBoundingClientRect(),i=new a((o.x-e.left)*t.width/e.width,(o.y-e.top)*t.height/e.height),r=h.circles.filter(i.collisionDetector);for(let s of r){let c=h.circles.indexOf(s);h.circles.splice(c,1)}r.length===0&&h.circles.push(new L(i.x,i.y))},G=()=>{let o=document.getElementById("boids");o.addEventListener("mouseup",j);let t=()=>(o.height=o.clientHeight,o.width=o.clientWidth,void 0);t(),window.addEventListener("resize",t),h.generate(),document.getElementById("reset-button").addEventListener("click",h.generate)};window.addEventListener("DOMContentLoaded",G);
