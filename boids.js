"use strict";class Vector2D{constructor(t,e){var i;typeof t=="number"?(this.x=t,this.y=e):(this.x=t.x,this.y=(i=t==null?void 0:t.y)!=null?i:e)}add(t){this.x+=t.x,this.y+=t.y}added(t){return new Vector2D(this.x+t.x,this.y+t.y)}get collisionDetector(){return t=>t.doesCollide(this)}copyTo(t){t.x=this.x,t.y=this.y}crossProduct(t){return this.x*t.y-this.y*t.x}divide(t){this.x/=t,this.y/=t}dividedBy(t){return new Vector2D(this.x/t,this.y/t)}dotProduct(t){return this.x*t.x+this.y*t.y}from(t){return new Vector2D(this.x-t.x,this.y-t.y)}get length(){return Math.hypot(this.x,this.y)}get squareOfLength(){return this.dotProduct(this)}get retrorse(){return new Vector2D(-this.x,-this.y)}rotate(t){const[e,i,n,s]=[Math.cos(t),Math.sin(t),this.x,this.y];this.x=n*e-s*i,this.y=n*i+s*e}rotatedBy(t){const[e,i]=[Math.cos(t),Math.sin(t)];return new Vector2D(this.x*e-this.y*i,this.x*i+this.y*e)}scale(t){this.x*=t,this.y*=t}scaledBy(t){return new Vector2D(this.x*t,this.y*t)}sub(t){this.x-=t.x,this.y-=t.y}}class Acceleration extends Vector2D{constructor(){super(0,0);this.count=0}add(e){super.add(e),this.count++}effectTo(e){this.count&&e.add(this.dividedBy(this.count))}}class Deceleration extends Acceleration{add(t){super.sub(t),this.count++}}class AvoidanceDeceleration extends Deceleration{match(t){const e=t.distance<12;return e&&this.add(t.vector.dividedBy(t.distance*4)),e}}class FarAcceleration extends Acceleration{match(t){const e=t.distance;for(let i=0;i<4;i++)if(e<48+i*24)return this.add(t.vector.dividedBy(e*(i+1)*8)),!0}}class SpreadAcceleration extends Acceleration{constructor(e){super();this.spread=e}match(e){const i=e.distance<this.spread;if(i){const n=e.relationalBoid;this.add(n.velocity.dividedBy(n.speed*32))}return i}}class Boid{constructor(t,e,i,n,s){this.all=t;this.canvas=e;this.circles=i;this.context=n;this.index=s;do{const r=20+Math.random()*(e.width-40),c=20+Math.random()*(e.height-40);this.position=new Vector2D(r,c)}while(i.some(this.position.collisionDetector));this.velocity=new Vector2D(1-Math.random()*2,1-Math.random()*2)}avoidCircles(){var t;for(const e of this.circles.filter(this.position.collisionDetector)){this.position.sub(this.velocity);const i=e.intersectingPoint(this);(t=i==null?void 0:i.rotate(this))!=null||(this.position.from(e.center).copyTo(this.velocity),this.normalize()),this.position.add(this.velocity)}}draw(){this.context.beginPath(),this.context.fillStyle="rgb(255, 128, 0)",this.context.arc(this.position.x,this.position.y,1,0,Math.PI*2,!0),this.context.fill()}drawCanvas(){this.context.fillStyle="rgba(0, 0, 0, .1)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}drawCircles(){this.circles.forEach(t=>t.draw())}set globalCompositeOperation(t){this.context.globalCompositeOperation=t}move(){this.position.add(this.velocity),this.avoidCircles(),this.turnOverByEdgeOfCanvas()}get nextPoint(){return this.position.added(this.velocity)}normalize(){const t=.8+Math.random()*1.2,e=this.speed;t<e&&this.velocity.scale(t/e)}get others(){return this.all.filter((t,e)=>e!=this.index)}get speed(){return this.velocity.length}turnOverByEdgeOfCanvas(){this.position.x<0&&(this.position.x=0,this.velocity.x=Math.abs(this.velocity.x)),this.canvas.width<this.position.x&&(this.position.x=this.canvas.width,this.velocity.x=-Math.abs(this.velocity.x)),this.position.y<0&&(this.position.y=0,this.velocity.y=Math.abs(this.velocity.y)),this.canvas.height<this.position.y&&(this.position.y=this.canvas.height,this.velocity.y=-Math.abs(this.velocity.y))}update(){const t=[new AvoidanceDeceleration,new SpreadAcceleration(16+Math.random()*8),new FarAcceleration];for(const e of this.others){const i=new BoidRelationship(this,e);t.find(n=>n.match(i))}for(const e of t)e.effectTo(this.velocity)}}class BoidRelationship{constructor(t,e){this.baseBoid=t;this.relationalBoid=e;this.vector=e.position.from(t.position),this.distance=this.vector.length}}class Circle{constructor(t,e,i,n=100,s="rgba(32, 32, 48, .5)"){this.context=t;this.radius=n;this.color=s;this.center=new Vector2D(e,i)}amplitude(t,e){const i=e.position.added(e.velocity.scaledBy(t)),[n,s]=[e.nextPoint,this.center].map(r=>r.from(i));return Math.acos(n.dotProduct(s)/(n.length*s.length))}draw(){this.context.beginPath(),this.context.fillStyle=this.color,this.context.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2,!0),this.context.fill()}doesCollide(t){return this.center.from(t).length<=this.radius}intersectingPoint(t){const e=t.position.from(this.center),i=t.velocity.squareOfLength,n=-t.velocity.dotProduct(e),s=e.squareOfLength-this.squareOfRadius,r=n*n-i*s;if(0<=r){const c=Math.sqrt(r),a=[(n+c)/i,(n-c)/i];if(a.some(within(0,1)))return new IntersectingPoint(this.amplitude(a[0],t))}}get squareOfRadius(){return this.radius*this.radius}}class IntersectingPoint{constructor(t){this.rotation=Math.PI-(t*2<=Math.PI?2:1)*t}rotate(t){return t.velocity.rotate(this.rotation),!0}}const addOrRemoveCircle=(o,t,e)=>{const i=e.target.getBoundingClientRect(),n=new Vector2D(e.clientX,e.clientY).from(new Vector2D(i.left,i.top)),s=o.filter(n.collisionDetector);for(const r of s){const c=o.indexOf(r);o.splice(c,1)}s.length==0&&o.push(new Circle(t,n.x,n.y))},domContentLoaded=()=>{const o=document.getElementById("boids");o.onmouseup=c=>addOrRemoveCircle(e,t,c);const t=o.getContext("2d"),e=generateCircles(o,t),i=[],n=()=>updateBoids(i);generateBoids(i,o,e,t);const s={intervalId:setInterval(n,25)};document.getElementById("reset-button").addEventListener("click",c=>{clearInterval(s.intervalId),i.splice(0),generateBoids(i,o,e,t),s.intervalId=setInterval(n,25)})},generateBoids=(o,t,e,i)=>{const{value:n}=document.getElementById("number-of-boids");for(let s=0;s<parseInt(n);s++)o.push(new Boid(o,t,e,i,s))},generateCircles=(o,t)=>{const e=[];for(let i=0;i<1;i++){const n=100+Math.random()*(o.width-200),s=100+Math.random()*(o.height-200);e.push(new Circle(t,n,s))}return e},updateBoids=o=>{const t=o[0];t.globalCompositeOperation="source-over",t.drawCanvas(),t.drawCircles(),t.globalCompositeOperation="lighter";for(const e of o)e.draw(),e.update();for(const e of o)e.normalize(),e.move()},within=(o,t)=>e=>o<=e&&e<=t;window.addEventListener("DOMContentLoaded",domContentLoaded);
